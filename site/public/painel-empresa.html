<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel da Empresa</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css" rel="stylesheet">
    <!-- Style -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/signup.css">
    <link rel="stylesheet" href="css/painel-empresa.css">

    <!-- Scripts -->
    <script src="js/market.js" defer></script>
    <script src="js/signup.js" defer></script>
</head>

<body>
    <nav>
        <div class="container">
            <a href="#">
                <img src="assets/images/logo.png" id="logo">
            </a>
            <div class="user-area">
                <button id="btn-notifications">
                    <i class="ri-notification-2-fill"></i>
                    <span>Notificações</span>
                </button>
                <div class="wrapper-dropdown">
                    <button id="btn-dropdown-user">
                        <img class="user-image" src="https://avatars.githubusercontent.com/u/93455951?v=4">
                    </button>
                    <div id="dropdown-user">
                        <div class="dropdown-container">
                            <p id="user-name">
                                Kelvin Santos
                            </p>
                            <p id="user-email">
                                kelvin.jesus@sptech.school.com
                            </p>
                        </div>
                        <ul class="user-functions">
                            <li>
                                <a href="#" class="menu-item signout" id="drop-logout">Sair</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div id="sidebar">
        <div class="wrapper-sidebar-items">
            <ul class="sidebar-list">
                <div>
                    <a href="#" class="sidebar-item" id="btn-add-market">
                        <i class="ri-add-fill"></i>
                        <span>Adicionar Mercado</span>
                    </a>
                </div>
                <li>
                    <a href="#" class="sidebar-item active disable">
                        <i class="ri-store-fill"></i>
                        <span>Mercados</span>
                    </a>
                </li>
                <li>
                    <span href="#" class="sidebar-item sair" id="btLogout">
                        <i class="ri-logout-box-line"></i>
                        <span>Sair</span>
                    </span>
                </li>
            </ul>
        </div>
    </div>
    <dialog id="modal-add-mercado" close>
        <div class="title-and-close">
            <span class="modal-title">Adicionar novo mercado</span>
            <button class="close" id="close-modal">
                <i class="ri-close-fill"></i>
            </button>
        </div>
        <form id="form-market">
            <div class="wrapper-row">
                <div class="field">
                    <label for="nome">Nome</label>
                    <input type="text" id="inome_fantasia" placeholder="Informe o nome do mercado">
                </div>
                <div class="field">
                    <label for="cnpj">CNPJ</label>
                    <input type="text" id="icnpj" placeholder="00.000.000/0000-00" max="18">
                </div>
            </div>
            <div class="field">
                <label for="unidade">Unidade</label>
                <input type="text" id="iunidade" placeholder="Informe a unidade">
            </div>
            <div class="wrapper-row">
                <div class="field" style="width: 30%;">
                    <label for="cep">CEP</label>
                    <input type="text" id="icep" maxlength="9" placeholder="00000-000">
                </div>
                <div class="field">
                    <label for="logradouro">Endereço</label>
                    <input type="text" id="ilogradouro" placeholder="Informe seu endereço">
                </div>
                <div class="field" style="width: 20%;">
                    <label for="numero">Número</label>
                    <input type="text" id="inumero" placeholder="128">
                </div>
            </div>
            <div class="field">
                <label for="bairro">Bairro</label>
                <input type="text" id="ibairro" placeholder="Informe o bairro">
            </div>
            <div class="wrapper-row">
                <div class="field">
                    <label for="cidade">Cidade</label>
                    <input type="text" id="icidade" placeholder="São Paulo">
                </div>
                <div class="field">
                    <label for="estado">Estado/UF</label>
                    <input type="text" id="iestado" placeholder="SP">
                </div>
            </div>
            <div class="wrapper-submit">
                <!-- adicionar função ao onclick -->
                <button class="submit" onclick="cadastrarMercado()">Registrar</button>
            </div>
        </form>
    </dialog>

    <dialog id="modal-create-user" close>
        <div class="title-and-close">
            <span class="modal-title">Adicionar usuário</span>
            <button class="close" id="close-modal-create-user">
                <i class="ri-close-fill"></i>
            </button>
        </div>
        <form id="form-create-user">
            <!-- FOREIGN KEYS -->
            <!-- Usuário de qual empresa? -->
            <!-- Usuário de qual mercado? -->
            <!-- Usuário de qual tipo? -->
            <input type="hidden" id="sigup_fkMercado">
            <div class="field">
                <label for="inome">Nome</label>
                <input type="text" id="signup_usuario" placeholder="John Doe">
            </div>
            <div class="field">
                <label for="iemail">Email</label>
                <input type="email" id="signup_email" placeholder="name@company.com">
            </div>
            <div class="field">
                <label for="isenha">Senha</label>
                <input type="password" id="signup_senha" placeholder="••••••••">
            </div>
            <div class="field">
                <label for="isenha">Confirmar senha</label>
                <input type="password" id="signup_confimsenha" placeholder="••••••••">
            </div>
            <div class="wrapper-submit">
                <button onclick="cadastrar()" id='cadastroUsuario' tipoUsuario='2' class="submit">Criar</button>
            </div>
        </form>
    </dialog>
    <div class="charts-container">
        <div class="charts-content">
            <!-- lista com cards rapidos e estatisticas simples -->
            <div class="chart-grid cols-1">
                <table>
                    <thead>
                        <tr>
                            <td>Nome</td>
                            <td>CNPJ</td>
                            <td>Unidade</td>
                            <td>CEP</td>
                            <td>Criado em</td>
                            <td></td>
                            <td></td>
                        </tr>
                    </thead>
                    <tbody class="market-list-tbody">
                        
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
<script>
const inputCep = document.getElementById('icep');
    const inputCnpj = document.getElementById('icnpj');
    
    inputCep.addEventListener('blur', buscarEndereco);
    inputCep.addEventListener('keypress', mascaraCep);
    inputCnpj.addEventListener('keypress', mascaraCnpj);


    function buscarEndereco() {
        let cep = inputCep.value.replace('-', '');
        if (cep.length == 8) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`, {
                method: 'get',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(function(resposta) {
                resposta.json()
                .then(function(json) {
                    console.log(json)
                    preencherEndereco(json)
                }).catch(function(e) {
                    console.log(e); 
                })
            });
        }
    }

    function preencherEndereco(endereco) {
        let mensagem;

        if(endereco.erro == true) {
            mensagem = 'Não encontrado.'
        
            ilogradouro.value = mensagem;
            ibairro.value = mensagem;
            icidade.value = mensagem;
            iestado.value = mensagem;

        } else {
            mensagem = 'Carregando...'
        
            ilogradouro.value = mensagem;
            ibairro.value = mensagem;
            icidade.value = mensagem;
            iestado.value = mensagem;

            setTimeout(function() {
                ilogradouro.value = endereco.logradouro;
                ibairro.value = endereco.bairro;
                icidade.value = endereco.localidade;
                iestado.value = endereco.uf;
            }, 1000);
        }
    }

    // 22.222.222/2222-22 => length = 18
    function mascaraCnpj() {
        console.log(inputCnpj.value.length)
        if (inputCnpj.value.length === 2 || inputCnpj.value.length === 6) {
            inputCnpj.value += '.';
        }

        if (inputCnpj.value.length === 10) {
            inputCnpj.value += '/';
        }

        if (inputCnpj.value.length === 15) {
            inputCnpj.value += '-';
        }

        if (inputCnpj.value.length >= 18) {
            // Caso ultrapasse o limite 18 caracteres,
            // Pegue o valor que ja foi digitado a partir da posição 0
            // Até a posição 17, 
            // então sobre-escreva o valor do input sempre que ultrapassar o limite
            let maximoCaracteres = inputCnpj.value.slice(0, 17);

            inputCnpj.value = maximoCaracteres;
        }
    }


    // 22222-222 => length = 9
    function mascaraCep() {
        if (inputCep.value.length === 5) {
            inputCep.value += '-';
        }

        if (inputCep.value.length >= 9) {
            // Caso ultrapasse o limite 18 caracteres,
            // Pegue o valor que ja foi digitado a partir da posição 0
            // Até a posição 17, 
            // então sobre-escreva o valor do input sempre que ultrapassar o limite
            let maximoCaracteres = inputCep.value.slice(0, 8);

            inputCep.value = maximoCaracteres;
        }
    }

</script>
</html>